<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SmartShop - Demo</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* small helper for smooth scrolling */
    html { scroll-behavior: smooth; }
  </style>
</head>
<body class="bg-gray-50 text-gray-800">
  <!-- NAVBAR -->
  <header class="fixed top-0 inset-x-0 z-40 bg-white/90 backdrop-blur border-b">
    <div class="max-w-6xl mx-auto flex items-center justify-between p-4">
      <div class="flex items-center gap-4">
        <a href="#home" class="font-bold text-xl">SmartShop</a>
        <nav class="hidden md:flex gap-4 items-center" id="mainNav">
          <a href="#home" data-link class="nav-link px-3 py-2 rounded">Home</a>
          <a href="#products" data-link class="nav-link px-3 py-2 rounded">Products</a>
          <a href="#reviews" data-link class="nav-link px-3 py-2 rounded">Reviews</a>
          <a href="#contact" data-link class="nav-link px-3 py-2 rounded">Contact</a>
        </nav>
      </div>

      <div class="flex items-center gap-3">
        <div class="hidden md:flex items-center gap-2 border rounded px-3 py-1">
          <span id="balanceDisplay">Balance: 1000 BDT</span>
          <button id="addMoneyBtn" class="ml-2 text-sm px-2 py-1 bg-green-600 text-white rounded">+1000</button>
        </div>
        <button id="cartBtn" class="relative px-3 py-2 bg-indigo-600 text-white rounded">Cart <span id="cartCount" class="ml-2 bg-white text-indigo-700 px-2 rounded">0</span></button>
        <button id="mobileMenuBtn" class="md:hidden p-2">☰</button>
      </div>
    </div>
    <!-- Mobile nav -->
    <div id="mobileNav" class="hidden md:hidden border-t">
      <div class="flex flex-col p-4 gap-2">
        <a href="#home" data-link class="nav-link px-3 py-2 rounded">Home</a>
        <a href="#products" data-link class="nav-link px-3 py-2 rounded">Products</a>
        <a href="#reviews" data-link class="nav-link px-3 py-2 rounded">Reviews</a>
        <a href="#contact" data-link class="nav-link px-3 py-2 rounded">Contact</a>
      </div>
    </div>
  </header>

  <main class="pt-28 max-w-6xl mx-auto px-4">
    <!-- SLIDING BANNER -->
    <section id="home" class="mb-8">
      <div class="relative rounded overflow-hidden shadow">
        <div id="banner" class="h-56 md:h-96 relative">
          <!-- slides injected by JS -->
        </div>
        <div class="absolute inset-y-0 left-0 flex items-center">
          <button id="prevSlide" class="p-3 m-3 bg-white/80 rounded">◀</button>
        </div>
        <div class="absolute inset-y-0 right-0 flex items-center">
          <button id="nextSlide" class="p-3 m-3 bg-white/80 rounded">▶</button>
        </div>
      </div>
    </section>

    <!-- PRODUCTS CONTROLS -->
    <section id="products" class="mb-6">
      <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4">
        <h2 class="text-2xl font-semibold">Products</h2>
        <div class="flex gap-2 w-full md:w-auto">
          <input id="searchInput" placeholder="Search products..." class="flex-1 md:flex-none px-3 py-2 border rounded"/>
          <select id="sortSelect" class="px-3 py-2 border rounded">
            <option value="">Sort</option>
            <option value="price-asc">Price: Low to High</option>
            <option value="price-desc">Price: High to Low</option>
            <option value="rating-desc">Rating: High to Low</option>
          </select>
        </div>
      </div>

      <div id="productsGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        <!-- product cards created by JS -->
      </div>
    </section>

    <!-- REVIEWS -->
    <section id="reviews" class="mb-8">
      <h2 class="text-2xl font-semibold mb-4">Customer Reviews</h2>
      <div class="relative rounded shadow overflow-hidden bg-white p-4">
        <div id="reviewsCarousel" class="min-h-[140px]">
          <!-- reviews inserted by JS -->
        </div>
        <div class="flex justify-between mt-4">
          <button id="prevRev" class="px-3 py-1 border rounded">Prev</button>
          <button id="nextRev" class="px-3 py-1 border rounded">Next</button>
        </div>
      </div>
    </section>

    <!-- CONTACT (bonus) -->
    <section id="contact" class="mb-12">
      <h2 class="text-2xl font-semibold mb-4">Contact Us</h2>
      <form id="contactForm" class="grid grid-cols-1 md:grid-cols-2 gap-4 max-w-2xl">
        <input id="cname" placeholder="Your name" class="px-3 py-2 border rounded" required />
        <input id="cemail" type="email" placeholder="Your email" class="px-3 py-2 border rounded" required />
        <textarea id="cmessage" placeholder="Message" class="md:col-span-2 px-3 py-2 border rounded" required></textarea>
        <button type="submit" class="md:col-span-2 px-4 py-2 bg-indigo-600 text-white rounded">Send Message</button>
      </form>
      <div id="contactThanks" class="hidden mt-3 p-3 bg-green-50 border rounded">Thank you! We received your message.</div>
    </section>

  </main>

  <!-- CART SIDEBAR -->
  <aside id="cartSidebar" class="fixed right-0 top-0 h-full w-full md:w-96 bg-white shadow-lg transform translate-x-full transition-transform z-50">
    <div class="p-4 flex items-center justify-between border-b">
      <h3 class="text-lg font-semibold">Your Cart</h3>
      <button id="closeCart" class="text-sm px-2 py-1">Close</button>
    </div>
    <div class="p-4 flex flex-col gap-4 h-[70%] overflow-auto" id="cartItems">
      <!-- items here -->
    </div>
    <div class="p-4 border-t">
      <div class="flex justify-between"><span>Subtotal</span><span id="subtotal">0 BDT</span></div>
      <div class="flex justify-between"><span>Delivery</span><span id="delivery">50 BDT</span></div>
      <div class="flex justify-between"><span>Shipping</span><span id="shipping">60 BDT</span></div>
      <div class="flex justify-between items-center mt-2">
        <input id="couponInput" placeholder="Coupon code" class="px-2 py-1 border rounded" />
        <button id="applyCoupon" class="ml-2 px-2 py-1 bg-indigo-600 text-white rounded">Apply</button>
      </div>
      <div class="flex justify-between mt-3 font-semibold text-lg"><span>Total</span><span id="total">0 BDT</span></div>
      <div id="cartWarnings" class="mt-2 text-sm text-red-600"></div>
      <div class="mt-3 flex gap-2">
        <button id="checkoutBtn" class="flex-1 px-3 py-2 bg-green-600 text-white rounded">Checkout</button>
      </div>
    </div>
  </aside>

  <!-- FOOTER -->
  <footer class="mt-12 bg-white border-t py-6">
    <div class="max-w-6xl mx-auto px-4 flex flex-col md:flex-row justify-between items-center gap-4">
      <div>© <span id="year">2025</span> SmartShop. All rights reserved.</div>
      <div class="flex gap-4">
        <a href="#home">Home</a>
        <a href="#products">Products</a>
        <a href="#contact">Contact</a>
      </div>
      <button id="backToTop" class="px-3 py-1 border rounded">Back to Top</button>
    </div>
  </footer>

<script>
/* ================================
   SmartShop: single-file demo
   Features implemented:
   - Fetch products from FakeStore API
   - Dynamic product cards
   - Cart with subtotal, delivery, shipping, coupon (SMART10)
   - User balance with localStorage and Add Money
   - Reviews carousel from local array
   - Sliding banner
   - Search & Sort
   - Contact form validation
   ================================*/

const API = 'https://fakestoreapi.com/products';
let products = [];
let cart = {}; // {productId: qty}
let balanceKey = 'smartshop_balance';
let defaultBalance = 1000;
let coupon = { code: 'SMART10', type: 'percent', value: 10 };
let deliveryCharge = 50;
let shippingCharge = 60;

// --- Init ---
function $(s){return document.querySelector(s)}
function $all(s){return document.querySelectorAll(s)}

// Balance
function getBalance(){
  const b = localStorage.getItem(balanceKey);
  return b ? Number(b) : (localStorage.setItem(balanceKey, defaultBalance), defaultBalance);
}
function setBalance(v){ localStorage.setItem(balanceKey, v); updateBalanceUI(); }
function updateBalanceUI(){ $('#balanceDisplay').textContent = `Balance: ${getBalance()} BDT`; }

// Cart helpers
function saveCart(){ localStorage.setItem('smartshop_cart', JSON.stringify(cart)); updateCartUI(); }
function loadCart(){ const c = localStorage.getItem('smartshop_cart'); cart = c ? JSON.parse(c) : {}; updateCartUI(); }

function addToCart(id){
  if(!cart[id]) cart[id]=0;
  cart[id]++;
  saveCart();
}
function removeFromCart(id){ delete cart[id]; saveCart(); }
function changeQty(id, qty){ if(qty<=0) removeFromCart(id); else { cart[id]=qty; saveCart(); }}

function calculateTotals(){
  let subtotal = 0;
  for(const id in cart){
    const prod = products.find(p=>p.id==id);
    if(prod) subtotal += prod.price * cart[id];
  }
  let couponVal = 0;
  const applied = $('#couponInput').dataset.applied === 'true';
  if(applied) couponVal = (coupon.type==='percent') ? subtotal * (coupon.value/100) : coupon.value;
  const total = subtotal + deliveryCharge + shippingCharge - couponVal;
  return { subtotal, couponVal, total };
}

function updateCartUI(){
  // count
  const count = Object.values(cart).reduce((s,n)=>s+n,0);
  $('#cartCount').textContent = count;

  // items
  const container = $('#cartItems'); container.innerHTML = '';
  for(const id in cart){
    const prod = products.find(p=>p.id==id);
    if(!prod) continue;
    const qty = cart[id];
    const el = document.createElement('div');
    el.className = 'flex items-center gap-3';
    el.innerHTML = `
      <img src="${prod.image}" class="w-12 h-12 object-contain" />
      <div class="flex-1">
        <div class="font-semibold">${prod.title}</div>
        <div class="text-sm">${prod.price.toFixed(2)} BDT</div>
      </div>
      <div class="flex items-center gap-1">
        <input type="number" min="0" value="${qty}" data-id="${id}" class="w-16 px-2 py-1 border rounded qtyInput" />
        <button data-id="${id}" class="removeBtn text-sm px-2 py-1 border rounded">Remove</button>
      </div>
    `;
    container.appendChild(el);
  }

  // totals
  const totals = calculateTotals();
  $('#subtotal').textContent = `${totals.subtotal.toFixed(2)} BDT`;
  $('#total').textContent = `${totals.total.toFixed(2)} BDT`;

  // warnings
  const bal = getBalance();
  const warnings = $('#cartWarnings');
  if(totals.total > bal) warnings.textContent = 'Total exceeds your available balance. Add money or remove items.'; else warnings.textContent = '';

  // attach events
  $all('.removeBtn').forEach(b=>b.onclick = e=>{ removeFromCart(e.target.dataset.id); });
  $all('.qtyInput').forEach(inp=> inp.onchange = e=>{ changeQty(e.target.dataset.id, Number(e.target.value)); });
}

// --- Products fetch & render ---
async function loadProducts(){
  try{
    const res = await fetch(API);
    products = await res.json();
  }catch(e){
    console.error('Failed to fetch products, using fallback', e);
    products = [
      {id:1,title:'Fallback Product',price:99.99,image:'https://via.placeholder.com/150',rating:{rate:4.1,count:10}}
    ];
  }
  renderProducts(products);
}

function renderProducts(list){
  const grid = $('#productsGrid'); grid.innerHTML='';
  list.forEach(p=>{
    const card = document.createElement('div'); card.className='bg-white p-4 rounded shadow';
    card.innerHTML = `
      <div class="h-48 flex items-center justify-center">
        <img src="${p.image}" alt="${p.title}" class="max-h-full object-contain" />
      </div>
      <h3 class="mt-3 font-semibold text-sm">${p.title}</h3>
      <div class="mt-2 flex items-center justify-between">
        <div>
          <div class="text-lg font-bold">${p.price.toFixed(2)} BDT</div>
          <div class="text-sm">⭐ ${p.rating?.rate ?? 'N/A'}</div>
        </div>
        <div>
          <button data-id="${p.id}" class="addBtn px-3 py-2 bg-indigo-600 text-white rounded">Add to Cart</button>
        </div>
      </div>
    `;
    grid.appendChild(card);
  });
  // add events
  $all('.addBtn').forEach(b=> b.onclick = e=>{ const id = e.target.dataset.id; addToCart(id); });
}

// --- Banner slider ---
const bannerImages = [
  'https://picsum.photos/id/1011/1200/600',
  'https://picsum.photos/id/1018/1200/600',
  'https://picsum.photos/id/1021/1200/600'
];
let bannerIndex = 0;
let bannerTimer;
function renderBanner(){
  const banner = $('#banner'); banner.innerHTML = '';
  bannerImages.forEach((src,i)=>{
    const img = document.createElement('img');
    img.src = src; img.className = `absolute inset-0 w-full h-full object-cover transition-opacity duration-700 ${i===bannerIndex? 'opacity-100':'opacity-0'}`;
    banner.appendChild(img);
  });
}
function nextBanner(){ bannerIndex = (bannerIndex+1)%bannerImages.length; renderBanner(); }
function prevBanner(){ bannerIndex = (bannerIndex-1+bannerImages.length)%bannerImages.length; renderBanner(); }
function startBannerAuto(){ clearInterval(bannerTimer); bannerTimer = setInterval(nextBanner, 4000); }

// --- Reviews carousel (local data) ---
const reviews = [
  {name:'Aisha', comment:'Great products and fast shipping.', rating:5, date:'2025-09-10'},
  {name:'Rafi', comment:'Good value for money.', rating:4, date:'2025-08-02'},
  {name:'Mina', comment:'Customer service helped quickly.', rating:5, date:'2025-07-15'}
];
let revIndex = 0; let revTimer;
function renderReview(){
  const container = $('#reviewsCarousel'); container.innerHTML = '';
  const r = reviews[revIndex];
  const el = document.createElement('div');
  el.innerHTML = `
    <div class="p-3">
      <div class="font-semibold">${r.name} <span class="text-sm text-yellow-600">${'★'.repeat(r.rating)}</span></div>
      <div class="text-sm text-gray-600">${r.date}</div>
      <div class="mt-2">${r.comment}</div>
    </div>
  `;
  container.appendChild(el);
}
function nextReview(){ revIndex=(revIndex+1)%reviews.length; renderReview(); }
function prevReview(){ revIndex=(revIndex-1+reviews.length)%reviews.length; renderReview(); }
function startReviewAuto(){ clearInterval(revTimer); revTimer = setInterval(nextReview,5000); }

// --- Utilities & UI wiring ---
function openCart(){ $('#cartSidebar').classList.remove('translate-x-full'); }
function closeCart(){ $('#cartSidebar').classList.add('translate-x-full'); }

// Coupon apply
$('#applyCoupon').onclick = ()=>{
  const v = $('#couponInput').value.trim().toUpperCase();
  if(v===coupon.code){ $('#couponInput').dataset.applied='true'; alert('Coupon applied!'); updateCartUI(); } else { alert('Invalid coupon'); $('#couponInput').dataset.applied='false'; updateCartUI(); }
}

// Checkout
$('#checkoutBtn').onclick = ()=>{
  const totals = calculateTotals();
  const bal = getBalance();
  if(totals.total > bal){ alert('You do not have enough balance.'); return; }
  // deduct and clear cart
  setBalance(bal - totals.total);
  cart = {}; saveCart();
  alert('Purchase successful!');
  closeCart();
}

// Add money
$('#addMoneyBtn').onclick = ()=>{ const b = getBalance(); setBalance(b+1000); }

// Cart button
$('#cartBtn').onclick = ()=> openCart(); $('#closeCart').onclick = ()=> closeCart();

// Contact form
$('#contactForm').onsubmit = (e)=>{ e.preventDefault(); $('#contactThanks').classList.remove('hidden'); $('#contactForm').reset(); setTimeout(()=>$('#contactThanks').classList.add('hidden'),4000); }

// Back to top
$('#backToTop').onclick = ()=> window.scrollTo({top:0,behavior:'smooth'});

// Mobile menu
$('#mobileMenuBtn').onclick = ()=> $('#mobileNav').classList.toggle('hidden');

// Nav highlight on click
$all('[data-link]').forEach(a=> a.onclick = (e)=>{ $all('.nav-link').forEach(x=> x.classList.remove('bg-indigo-100')); e.target.classList.add('bg-indigo-100'); if(window.innerWidth<768) $('#mobileNav').classList.add('hidden'); });

// Search & sort
$('#searchInput').oninput = (e)=>{ const q = e.target.value.toLowerCase(); const filtered = products.filter(p=> p.title.toLowerCase().includes(q) || (p.category||'').toLowerCase().includes(q)); renderProducts(filtered); };
$('#sortSelect').onchange = (e)=>{
  const val = e.target.value; let arr = [...products];
  if(val==='price-asc') arr.sort((a,b)=>a.price-b.price);
  if(val==='price-desc') arr.sort((a,b)=>b.price-a.price);
  if(val==='rating-desc') arr.sort((a,b)=> (b.rating?.rate||0)-(a.rating?.rate||0));
  renderProducts(arr);
}

// init
(async function init(){
  updateBalanceUI();
  loadCart();
  await loadProducts();
  renderBanner(); startBannerAuto();
  $('#nextSlide').onclick = ()=>{ nextBanner(); startBannerAuto(); }
  $('#prevSlide').onclick = ()=>{ prevBanner(); startBannerAuto(); }
  renderReview(); startReviewAuto();
  $('#nextRev').onclick = ()=>{ nextReview(); startReviewAuto(); }
  $('#prevRev').onclick = ()=>{ prevReview(); startReviewAuto(); }

  // set current year
  $('#year').textContent = new Date().getFullYear();
})();

// load cart from localStorage on page load and attach update loop
window.addEventListener('storage', ()=>{ loadCart(); updateBalanceUI(); });

</script>
</body>
</html>
